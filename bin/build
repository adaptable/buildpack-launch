#!/usr/bin/env bash

set -euo pipefail

CNB_BP_LAYERS_DIR="$1"

printf "\nAdaptable Launch Buildpack\n"

if [[ -z "${BP_LAUNCH_COMMAND-}" ]]; then
  echo "  No launch command set"
  exit 0
fi

echo "  Assigning launch process: ${BP_LAUNCH_COMMAND}"
#DEBUG
pwd
ls

cat > "${CNB_BP_LAYERS_DIR}/launch.toml" <<EOF
[[processes]]
type = "web"
command = $(echo -n "${BP_LAUNCH_COMMAND}" | ./bin/jsontoml)
default = true
EOF

exit 0
